# ===================================================================
# COMMON CONFIGURATION (APPLIES TO ALL ENVIRONMENTS)
# ===================================================================
spring.application.name=xamops-service
server.port=8080

# --- Set the default profile to 'local' if no other profile is specified ---
spring.profiles.active=local

# ==============================================================
# MASTER DATABASE CONFIGURATION (production_db)
# ==============================================================
spring.datasource.url=jdbc:postgresql://3.110.102.128:5432/production_db
spring.datasource.username=app_user
spring.datasource.password=AppPassword123
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# ==============================================================
# DATABASE CONNECTION POOL (HIKARI) - PHASE 1 STABILITY FIX
# ==============================================================
# Connection Timeout: Fail fast if a connection cannot be obtained (10 seconds)
# Reduced from 30s to prevent threads hanging during outages
spring.datasource.hikari.connection-timeout=10000

# Idle Timeout: 2 mins (120000ms) - Close idle connections quickly to free resources
spring.datasource.hikari.idle-timeout=120000

# Max Lifetime: 10 mins (600000ms) - Adjusted for stability
# This prevents holding connections that network devices might drop silently
spring.datasource.hikari.max-lifetime=600000

# Keepalive: 30s (30000ms) - CRITICAL FIX
# Perform a health check on idle connections every 30 seconds to detect broken links
# BEFORE the application tries to use them
spring.datasource.hikari.keepalive-time=30000

spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=10

# Validation: Verify connection is alive before giving it to the app
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.test-while-idle=true
spring.datasource.hikari.validation-timeout=3000

# --- SpringDoc OpenAPI (Swagger) Configuration ---
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/api-docs

# --- Common AWS & Application Logic ---
aws.region=ap-south-1
tagging.compliance.required-tags=cost-center,project
rightsizing.instance-size-order=nano,micro,small,medium,large,xlarge,2xlarge,4xlarge,8xlarge,12xlarge,16xlarge,24xlarge
quotas.key-codes=L-1216C47A,L-F678F1CE,L-7295265B,L-69A177A2
pricing.ebs.fallback-price=0.10

# --- Rate Limiting for Dashboard API ---
bucket4j.filters[0].url=^/api/dashboard.*
bucket4j.filters[0].rate-limit.bandwidths[0].capacity=10
bucket4j.filters[0].rate-limit.bandwidths[0].time=1
bucket4j.filters[0].rate-limit.bandwidths[0].unit=minutes

# --- Default Redis Port ---
spring.redis.port=6379

# --- General Settings ---
spring.security.debug=false
spring.mvc.async.request-timeout=120000
server.servlet.session.timeout=1d
server.servlet.session.cookie.path=/

# --- Mail Configuration ---
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=notifications@xamops.com
spring.mail.password=biph daxm lnjt imer
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

app.s3.bucket-name=xamops-document-bucket
app.s3.region=ap-south-1

# --- AutoSpotting Configuration ---
autospotting.enabled=true
autospotting.dynamodb.table-name=autospotting-CustomerAccounts
autospotting.tag.key=spot-enabled
autospotting.tag.value=true
autospotting.metric.namespace=AutoSpotting
autospotting.api.base-url=https://do0ezmdybge0h.cloudfront.net/api
autospotting.api.key=sHX4wpgTYZhdBI8LxrM8lhkY8eFgsIg2

# --- CloudFormation ---
cloudformation.s3.bucket=xamops-cloudformation-templates
cloudformation.s3.region=ap-south-1

# --- JSON / Jackson ---
logging.level.com.fasterxml.jackson=DEBUG
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-dates-as-timestamps=false

# --- XamOps AI Configuration ---
anythingllm.api.key=8KFYS8C-Z2H4JMB-GHY2V1D-JK7YFGD
anythingllm.url=http://13.200.255.73:3001/api/v1/workspace/xamops-workspace/chat

# --- Timeouts ---
spring.http.client.read-timeout=300s
rest.template.read-timeout=300000

# --- External Tools ---
prowler.executable.path=C:\\Users\\Akshay\\AppData\\Roaming\\Python\\Python313\\Scripts\\prowler.exe